# Salt Cloud
# =============================================================================
- [X] pre-apply  : add roles on /etc/salt/grains (done via *.map for salt-cloud)
- [ ] post-action: add IP in nftables pillar (other place than YAML)
	=> faire un script d'extraction (static + ovh API) pour remplir le dit fichier
	   ou check avec runner/reactionner

	ex: https://github.com/hkbakke/saltstack-states/blob/master/borgbackup/server.sls (orchestrate + event + reactioner)

- [ ] post-action: add DNS in OVH
- [ ] post-action: mount IPv6
- [X] post-action: mount vRack => isOk via cloud-init
- [X] apply	 : set a default password for user
- [X] apply	 : add sudoers.d rules for user
- [X] apply	 : manage /etc/hosts


# Backup management
# =============================================================================
- [ ] Use borgbackup
  * https://github.com/MEschenbacher/borgbackup-formula
- [ ] Two roles BackupServer and BackupAgent (= not BackupServer)
  * if backup server, prepare space to receive backup (need to spawn a vm)
  * if backup server, use mine to prepare accepted keys ?
  * if agent, generate key for the backup
  * if agent, configure what need to be backuped


# Monitoring
# =============================================================================
- [ ] Monitoring local des containers docker (pas de docker en exited)
- [ ] Monitoring ext. des sitewebs (all, portainer/koel/grafana/etc...)


# DNS management on local_dns
# =============================================================================
- [ ] Configure DNS on srv002 via salt

->https://github.com/saltstack-formulas/bind-formula


# Bastion
# =============================================================================
- [ ] monitoring docker access to bastion
- [ ] if down -> restart docker ! (implement a reactionner ?)
      if change in nftables, restart docker (reactionner / runner)

# Warden
# =============================================================================
- [ ] Automatiser l'installation
	* curl (?) vs depot fichier
	* updateself
- [ ] Automatiser update (schedule regulier)
	* updateself
	* update


#
# srv002 - hassio
# =============================================================================
- [ ] Automatiser installation + restore
- [ ] Automatiser update ?


# Maison / Domotique
# =============================================================================
- Continuer domotique (lampe, energie, temperature etage, ...)
- monitoring de netatmo


# saltstack - server
# =============================================================================

- [ ] Mettre sous salt la conf salt (surtout la partie cloud)
- [ ] Mettre sous salt la partie webhook
- [ ] Mettre en place l'auto-deploy par webhook pour le git salt
- [ ] Mettre en place un auto-fetch pour les formula ?
- [ ] Faire marcher le salt-lint sur github action (check)